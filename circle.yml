# general build-related configurations that are not related to a specific phase,
general:
  artifacts:
    - "build/reports"
    - "build/resources/main/CHANGELOG.md"
    - "build/libs"

  branches:
    ignore:
      - gh-pages # list of branches to ignore

#adjusting the VM to your preferences and requirements
machine:
  java:
    version: oraclejdk8
  timezone: Europe/Berlin

# setting up your project's language-specific dependencies
dependencies:
  override:
    - chmod +x gradlew
    # publish changelog to gh-pages so it can be hosted there
    - ./gradlew generateChangelog
#    - ./gradlew dependencies
#    - ./gradlew clean

  cache_directories:
    - "~/.gradle"
    - ".gradle"

# running your tests
test:
  override:
    - ./gradlew test
    - ./gradlew pitest
  post:
    # after all tests build the jars
    - ./gradlew build
#    - cp build/tests/*.xml $CIRCLE_TEST_REPORTS


# deploying your code to your web servers
# Only executed if all tasks are successful
deployment:
  # just a label. Label names are up to you
  production:
    branch: production
    commands:
      # publish javadoc to gh-pages so it can be hosted there
      - ./gradlew javadoc
      - git config user.name "Circle CI"
      - git config user.email "robot+circleci@thatsich.de"
      - git checkout gh-pages
      - rm -rf com resources
      - mv build/docs/javadoc/* .
      - git add .
      - git commit -m "[ci skip] Generate Javadoc"
      - git push origin gh-pages

      # upload to bintray
      - ./gradlew bintrayUpload

      # report coverage to coveralls
      - ./gradlew jacocoTestReport coveralls

      # update version eye badge
      # versioneye.api_key is required for the plugin to work.
      - ./gradlew -Pversioneye.api_key=$VERSION_EYE_KEY versioneye-update

#  release:
#    branch: release
#    commands:
      # publish github pre-release
      # publish github tag
#      -

#  develop:
#    branch: develop
#    commands:
      # generate changelog as artifact
#      - ./gradlew generateChangelog



      # publish github tag
#      -

#  pullrequest:
#    branch: /.*/
#    commands:
#      # just build?
#      -